<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="x-ua-compatible" content="IE=edge">
	<title>Least Soundings and Available Widths</title>
	<script src="/scripts/jquery-1.9.1.js"></script>
	<script src="/scripts/jquery.ui.core.js"></script>
	<script src="/scripts/jquery.ui.datepicker.js"></script>
	<script src="/scripts/jquery.dataTables.min.js"></script>
	<script src="/scripts/moment.min.js"></script>
	<script src="/scripts/avadepth.js"></script>
	<link rel="stylesheet" type="text/css" href="/wet-boew/dist/js/css/pe-ap-min.css">
	<link rel="stylesheet" type="text/css" href="/wet-boew/dist/grids/css/util-min.css">
	<link rel="stylesheet" type="text/css" href="/css/custom.css">
	<link rel="stylesheet" type="text/css" href="/wet-boew/dist/theme-gcwu-fegc/css/theme-min.css">

	<style type="text/css" media="screen">
		.span-8 {
			width: 98%;
		}
		#verify_wrapper {
			display: table;
			margin: 0 auto;
		}
		.print_holder {
			display: -webkit-box;
			display: -moz-box;
			display: -ms-flexbox;
			display: -webkit-flex;
			display: flex;
			height: 50px;
		}
		.button {
			height: 26px;
			margin: auto;
		}
	</style>

	<style type="text/css" media="print">
		.button {
			display: none;
		}
	</style>

	<script>
		$(document).ready(function() {
			if (opener.document) {
				var parentElem = window.opener.$("#detail_content").clone();
				if ((/Trident\/7\./).test(navigator.userAgent) ||
					(/MSIE/).test(navigator.userAgent)) {
					var outer = parentElem[0].outerHTML;
					$('#detail_content_popup')[0].innerHTML = outer;
				} else {
					$('#detail_content_popup').html(parentElem);
				}
				console.log(parentElem);
			}
			$('button[name="print"]').click(function() {
				window.print()
			});
			var closeButton = $('<input type="button" class="button button-accent" value="Close" onClick="window.close()">');
			$('.print_holder').append(closeButton);

			var url = window.location.href;
			var name = 'chainage';
			var name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			var chainage = decodeURIComponent(results[2].replace(/\+/g, " "));

			$('#print_remove').addClass('align-center')

			$('input[name=channel_select]').change(function() {			
				if(!($(this).is(':checked'))){return;}
				var detailIsInnerChannel=($(this).val()==="1");

				$('#detail_print').find('#segment').text($(this).next().text()); // updates print div with current channel information
				$('#surveys tbody').html('');
				
				//TODO: Replace following line for production
				return $.getJSON(("/api/History?date=" + moment().format("YYYY-M-D") + "&") +
					("lane=" + (detailIsInnerChannel ? "1" : "2")) + "&" +
					("chainage=" + chainage), function(data) {
					$.each(data, function (index) {
					var row, surveydate, ishigh="", ishighast="";
					surveydate = moment(this.date).format("D-MMM-YYYY");
					if(this.grade>this.sounding){
						ishigh=" class=\"red\"";
						ishighast="*";
					}
					if(this.Plan.slice(0,2) != "FR"){
						row = "<tr>" +
								"<td>" + surveydate + "</td>" +
								"<td><a href=\"http://www2.pac.dfo-mpo.gc.ca/Data/dwf/" + this.Plan + ".dwf?\"" +
										"target=\"_blank\">" + this.Plan + "</a></td>" +
								"<td"+ishigh+">" + (this.grade.toFixed(1)) + "</td>" +
								"<td"+ishigh+">" + (this.sounding.toFixed(1)) + ishighast + "</td>" +
								"<td"+ishigh+">" + this.width + "</td>" +
								"<td"+ishigh+">" + this.widthperc + "</td>" +
							"</tr>";
					}
					return $("#surveys tbody").append(row);
					});
				});
			});
		});
	</script>
</head>
<body>
	<div id="detail_content_popup"></div>
</body>
</html>
